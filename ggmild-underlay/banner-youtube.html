<html>
    <head>
        <script>
            var $ = window.parent.$;
            var jQuery = window.parent.jQuery;
            var curWin = window.parent.window;
            var curDoc = window.parent.document;
            var banner_selector = '#underlay_selector';
        </script>

    </head>
    <body>
      <div id="underlay-banner" class="underlay__banner" style="display: none">
        <style>
            #ad-container{
                position: relative;
            }
            #ad-image{
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                /*height: 100%;*/
                object-fit: cover;
            }
            #ad-video{
                position: fixed;
                width: 80%;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                margin: auto;
            }
            #ad-video-wrap iframe{
                position: fixed;
                width: 80%;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                margin: 0 auto;
            }
            #ad-close{
                position: fixed;
                width: 32px;
                height: 32px;
                top: 50px;
                right: 0;
                margin: auto;
                background-image: url('https://s.kaskus.id/img/seasonal/may2018/header_fbyjeue2rwio.png');
                background-position: center;
                background-size: contain;
                cursor: pointer;
                text-decoration: none;
            }
        </style>
        <div class="underlay__wrapper">
          <div class="underlay__show">
            <a href="%%CLICK_URL_UNESC%%http://meikarta.com/?utm_source=kaskus&utm_medium=mobile&utm_campaign=underlay%20ad" target="_blank">
              <div class="underlay__show__inner">
                <div class="underlay__show__fix">
                  <div class="underlay__show__banner">
                    <section id="ad-container">
                      <img id="ad-image" src="https://s.kaskus.id/img/seasonal/may2018/tematik/wp_background_fbyjeugln6mm.gif"/>
                      <div id="ad-video-wrap">
                          <iframe  id="joni" style="display: none" src="https://www.youtube.com/embed/OGI3UFzOgxQ?enablejsapi=1&version=3&loop=1&playerapiid=ytplayer&playlist=OGI3UFzOgxQ" allow="autoplay; encrypted-media"  allowscriptaccess="always" frameborder="0" allowfullscreen></iframe>
                      </div>
                      <a href="" id="ad-close" onclick="$('.underlay__show').hide();document.getElementById('video-container').getElementsByTagName('iframe')[0].contentWindow.postMessage(JSON.stringify({'event': 'command','func': 'pauseVideo','args': ''}), '*');"></a>
                    </section>
                  </div>
                </div>
              </div>
            </a>
          </div>
        </div>
      </div>
        <script>

            window.onmessage = function(e) {
                var videoElm = document.getElementById('ad-video-wrap');
                var youtubeFunc ='';
                var youtubeIframe = videoElm.getElementsByTagName("iframe")[0].contentWindow;
                switch (e.data) {
                    case 'BANNER_VISIBLE':
                        if (!videoElm.playing && !videoElm.ended) {
                            youtubeFunc = 'playVideo';
                            youtubeIframe.postMessage('{"event":"command","func":"' + youtubeFunc + '","args":""}', '*');
                            calculateIframe();
                            // document.getElementById('joni').style.display="block";
                        }
                        break;
                    case 'BANNER_INVISIBLE':
                        if (!videoElm.paused && !videoElm.ended) {
                            youtubeFunc = 'pauseVideo';
                            youtubeIframe.postMessage('{"event":"command","func":"' + youtubeFunc + '","args":""}', '*');
                        }
                        break;
                    default:
                        break;
                }
            }

            function calculateIframe(){
              console.log();
               //  var height= document.getElementById('ad-image').offsetHeight;
               // var width= document.getElementById('ad-image').offsetWidth;
               var height = $('#ad-image').height();
               var width = $('#ad-image').width();
               var top = Math.round((525/1290 * height) * 100) / 100;
               var widthIframe = Math.round((640/640 * width) * 100) / 100;
               var heightIframe = Math.round((395/1290 * height) * 100) / 100;

               // document.getElementById('joni').style.top = top+'px';
               // document.getElementById('joni').style.width = widthIframe+'px';
               // document.getElementById('joni').style.height = heightIframe+'px';
               $("#joni").css('top', top+'px');
               $("#joni").css('width', widthIframe+'px');
               $("#joni").css('height', heightIframe+'px');
               $("#joni").show();
            }
            $(curDoc).ready(function(){
              var banner_element = $(document.getElementById('underlay-banner'));
              var div_banner = $(curDoc.querySelector(banner_selector));
                div_banner.html(banner_element);
                banner_element.css('display', 'block');
                calculateIframe();
            });

            var tinggiScreenSize = $(curWin).height();

            $('.underlay__show').css('height',tinggiScreenSize);

            $('#ad-close').on('click', function() {
                console.log("woooy");
                var videoElm = document.getElementById('ad-video-wrap');
                var youtubeFunc = '';
                var youtubeIframe = videoElm.getElementsByTagName("iframe")[0].contentWindow;
                youtubeFunc = 'pauseVideo';
                youtubeIframe.postMessage('{"event":"command","func":"' + youtubeFunc + '","args":""}', '*');
                $("#joni").remove();
                $('.underlay__show').hide();
            });

            $(window).resize(function(){
              console.log("hoy");
               calculateIframe();
            });

        </script>
    </body>
</html>
