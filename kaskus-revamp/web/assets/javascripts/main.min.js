;
(function($) {

  $.fn.kslzy = function(threshold, callback) {

    var $w = $(window),
      images = this,
      threshold = threshold || 0;

    function checkVisible(elm, eval) {
      eval = eval || "visible";
      var spolier = $(elm).closest(".spoiler");
      if (spolier.length == 1) {
        elm = spolier;
      }
      var vpH = $w.height(), // Viewport Height
        st = $w.scrollTop(), // Scroll Top
        y = $(elm).offset().top,
        elementHeight = $(elm).height();
      //console.log("elm = "+elm+" y = "+y+" scrollTop = "+st+ " elementHeight = "+elementHeight+" Viewport = "+vpH+" threshold ="+threshold);
      if (eval == "visible") return ((y < (vpH + st + threshold)) && (y > (st - elementHeight - threshold)));
      if (eval == "above") return ((y < (vpH + st)));
    }

    this.one("display", function() {
      var downloadingImage = new Image();
      if ($(this).prop("tagName") == 'DIV' || $(this).prop("tagName") == 'A') {
        var currElem = this;
        downloadingImage.onload = function() {
          $(currElem).removeClass("mls-img")
            .addClass("rjn-img")
            .removeAttr("data-src")
            .hide()
            .fadeIn();

          if ($(currElem).attr("data-type") == "1") {
            $(currElem).css("background-image", "url(" + this.src + ")");
          } else {
            var img = $('<img class="lte-img">');
            img.attr('src', this.src);
            img.appendTo($(currElem));
          }

        };
      } else {
        var currImage = this;
        downloadingImage.onload = function() {
          $(currImage).removeClass("mls-img")
            .addClass("rjn-img")
            .removeAttr("data-src");

          $(currImage).attr('src', this.src);
        };
      }
      downloadingImage.src = $(this).attr("data-src");
    });

    function scan() {
      var inview = images.filter(function() {

        if ($(this).is(":visible") == false)
          return false;

        return checkVisible($(this));
      });

      loaded = inview.trigger("display");
      // console.log(inview);
      images = images.not(loaded);
    }

    $w.on("scroll.kslzy resize.kslzy lookup.kslzy click.kslzy", scan);

    scan();

    return this;

  };

})(window.jQuery || window.Zepto);


var linksearch, searchchoice, catLoaded, retryFetch = true;

// get category search header area
function get_cat(param) {
  if (param == 'forum' || param == 'fjb') {
    $('.select-category').addClass('show');
    $.ajax({
      url: '/misc/get_categories_search/' + param,
      success: function(result) {
        var checkurl = location.href.match(/forumchoice(\[\])*=([^&]+)/);
        var id = '';
        if (checkurl) {
          id = checkurl[2];
        }
        var selected = '';
        for (var i in result) {
          if (id == result[i].forum_id) {
            selected = "selected";
            $('#search_category').parent().find('.customSelectInner').text(result[i].name);
          } else {
            selected = '';
          }

          $('#search_category').append('<option data-child-list="' + result[i].child_list + '" value="' + result[i].forum_id + '" ' + selected + '>' + result[i].name + '</option>');
        }
      }
    });
  } else {
    $('.select-category').removeClass('show');
  }
}

// Spoiler

function spoiler(spoilerData) {
  if (spoilerData.value == "Show") {
    $(".content_" + $(spoilerData).attr("class")).slideDown(0);
    spoilerData.innerHTML = "";
    spoilerData.value = "Hide";
  } else {
    $(".content_" + $(spoilerData).attr("class")).slideUp(0);
    spoilerData.innerHTML = "";
    spoilerData.value = "Show";
  }
}


function get_smilies() {
  localSmilies = get_MRU();

  if (localSmilies) {
    var mru_smilies = {
      'smilies': $.param(localSmilies)
    };
  }

  $.ajax({
    method: "POST",
    url: '/misc/get_smilies',
    data: mru_smilies || {},
    success: function(result) {

      result = JSON.parse(result);
      smilies = JSON.parse(result.kaskus);

      $('.smilies-tab').replaceWith(smilies.tab);
      $('.smilies-tab-content').replaceWith(smilies.content);

      if (result.mru) {
        smilies_mru = result.mru;

        $('#content-mru').html(smilies_mru);

        // $('.smiley-tab > .nav-tabs > li[id^="group"]:first').removeClass('active');
        // $('#emoticons .tab-content > .tab-pane[id^="tab"]:first').removeClass('active');

        $('#mru').addClass('active');
        $('#content-mru').addClass('active');

        load_MRU();
      } else {
        $('#mru').hide();
        // $('.smiley-tab > .nav-tabs > li[id^="group"]:first').addClass('active');
        // $('#emoticons .tab-content > .tab-pane[id^="tab"]:first').addClass('active');
      }
      show_tab(".smiley-wrapper .smiley-tab .tab-content > .active");
      $('.smiley-tab__item').not('.smiley-tab__item--unavailable').find('.smilie__in-action').click(function() {
        get_focus();
        smiley_tracking(this.children);
        insert_smilikiti(this.children);
      });
      $('#emoticons').show();
    }
  });
}

function printDiv(divId) {
  window.frames["print_frame"].document.body.innerHTML = document.getElementById(divId).innerHTML;
  window.frames["print_frame"].window.focus();
  window.frames["print_frame"].window.print();
}

function get_MRU() {
  var temp = [];

  if (localStorage[mru_key]) {
    mru = JSON.parse(localStorage[mru_key]);

    if (mru) {
      for (var a in mru) {
        if (a.search("smilie") > -1) {
          temp.push(mru[a]);
        }
      }
      var data = {
        smilies: temp
      };
    }
  }

  return data || {};
}

function load_MRU() {
  var x = $('#content-mru').find('.loadMRU');

  if (x) {
    $.each(x, function(i, smilie) {
      $(smilie).attr('src', $('.loadSmilies[alt="' + $(smilie).attr('alt') + '"]').attr('data-src'));
      $(smilie).attr('title', $('.loadSmilies[alt="' + $(smilie).attr('alt') + '"]').attr('title'));
      $(smilie).removeAttr('class');
    });
  }

  return true;
}

function show_tab(tab_number) {
  var x = $(tab_number).find('.loadSmilies');

  if (x) {
    $.each(x, function(i, smilie) {
      $(smilie).attr('src', $(smilie).attr('data-src'));
      $(smilie).removeAttr('data-src');
      $(smilie).removeAttr('class');
    });
  }

  return true;
}

function insert_smilikiti(a) {
  if (localStorage) {
    var smilies = JSON.parse(localStorage.getItem(mru_key));

    if (smilies) {
      for (var b in smilies) {
        if (b === ('smilie' + $(a).attr("alt"))) {
          delete smilies[b];
        }
      }
    } else {
      var smilies = new Object();
    }

    if (mru_limit == Object.keys(smilies).length) {
      delete smilies[Object.keys(smilies)[0]];
    }

    smilies['smilie' + $(a).attr("alt")] = $(a).attr("alt");

    localStorage.setItem(mru_key, JSON.stringify(smilies));
  }
  emoticon = $(a).attr("alt") + " ",
    $.markItUp({
      replaceWith: emoticon
    })
  if ($.cookie('use_old_qnt') !== "1") {
    if (sceditorInstance.inSourceMode()) {
      sceditorInstance.insert($(a).attr("alt"))
    } else {
      sceditorInstance.insert('<img src="' + $(a).attr("src") + '" data-sceditor-emoticon="' + $(a).attr("alt") + '" border="0" alt="emoticon-' + $(a).attr("title") + '" title="' + $(a).attr("title") + '">', null, false);
    }
  }
}

// notice

function notice(text, timeout) {
  if (typeof timeout === 'undefined') {
    timeout = 3000;
  }

  if (document.notice_tid) {
    clearTimeout(document.notice_tid);
  }

  $('#notice_span').html(text);
  $('#floating_notice').show();
  document.notice_tid = setTimeout(function() {
    $('#floating_notice').fadeOut();
  }, timeout);
}

function printContent(el) {
  var restorepage = document.body.innerHTML;
  var printcontent = document.getElementById(el).innerHTML;
  document.body.innerHTML = printcontent;
  window.print();
  document.body.innerHTML = restorepage;
}

// Jump to page
function jump_page(e) {
  var t = $("#" + e).val();
  var n = $(".url_jump").val();
  window.location.href = n + t;
}

function show_signin_popup(theme) {
  $.ajax({
    url: "/user/login/" + theme,
    success: function(a) {
      $("#jsModalSignin .modal-body").html(a),
        $("#username").focus();
    }
  })
}

function show_signup_popup(theme) {
  $.ajax({
    url: "/register/index/" + theme,
    success: function(a) {
      $("#jsModalSignin .modal-body").html(a),
        $("#signup_email").focus();
    }
  })
}

//SEARCH

var ten_minutes = 600;
var one_second = 1;
var local_search_history_date;
var local_search_history;
var local_top_keyword_date;
var local_top_keyword;
var indexSelected = -1;
var last_process_time = 0;
var last_search_history;
var last_top_keyword;

function get_search_dropdown() {
  var time_now = Date.now() / 1000;
  if (parseFloat(last_process_time) + one_second > time_now)
    return;

  last_process_time = time_now;

  get_top_keyword();
  get_search_history();
  show_search_drop_down();
}

function show_search_drop_down() {
  var data_top_keyword = get_term_local_data('top_keyword');
  var data_search_history = get_cookie_term_local_data('search_history_' + user_id);

  show_template_search(data_top_keyword, 'top_search_choice', '#top_search', 'last_top_keyword');
  show_template_search(data_search_history, 'history_search_choice', '#history_search', 'last_search_history');

  $('.jsSearchResult li').hover(function(event) {
    $(".jsSearchResult").find('li.is-selected').removeClass('is-selected');
    $(this).addClass('is-selected');
    indexSelected = $(".jsSearchResult li").index($(this));
  });

  $(".jsSearchResult li").mousedown(function(e) {
    e.preventDefault();
    $("#search").val($(this).text());
    $("#btn-search").click();
  });
}

function show_template_search(terms, div_id, div_to_hide, last_data) {
  var temp_template = '';
  for (var i in terms) {
    temp_template += '<li><a href="javascript:void(0);" class="D(b) P(5px) C(#484848) Fz(12px) Td(n):h Bgc(#f2f2f2):h">' + terms[i] + '</a></li>';
  }

  if (temp_template != window[last_data]) {
    document.getElementById(div_id).innerHTML = temp_template;
    window[last_data] = temp_template;
    indexSelected = -1;
  }
  if (temp_template == '') {
    $(div_to_hide).hide();
  } else {
    $(div_to_hide).show();
  }
}

function get_top_keyword() {
  var top_keyword_date = null;
  if (localStorage) {
    top_keyword_date = parseFloat(localStorage.getItem("top_keyword_date"));
  } else {
    top_keyword_date = local_top_keyword_date;
  }
  var date_now = Date.now() / 1000;
  if (isNaN(top_keyword_date) || (top_keyword_date + ten_minutes) < date_now) {
    $.ajax({
      url: "/misc/get_top_keyword",
      success: function(a) {
        if (localStorage) {
          localStorage.setItem("top_keyword", a);
          localStorage.setItem("top_keyword_date", Date.now() / 1000);
        } else {
          local_top_keyword = JSON.parse(a);
          local_top_keyword_date = Date.now() / 1000;
        }

        show_search_drop_down();
      },
      error: function() {
        show_search_drop_down();
      }
    });
  }
}

function get_search_history() {
  var search_history_date = parseFloat($.cookie("search_history_date_" + user_id));
  var date_now = Date.now() / 1000;

  if (isNaN(search_history_date) || (search_history_date + ten_minutes) < date_now) {
    $.ajax({
      url: "/misc/get_search_history",
      success: function(a) {
        var cookie_domain = '';
        if (typeof KASKUS_COOKIE_DOMAIN !== 'undefined')
          cookie_domain = KASKUS_COOKIE_DOMAIN;
        else
          cookie_domain = COOKIE_DOMAIN;
        date_now = Date.now() / 1000;

        $.cookie("search_history_" + user_id, a, {
          expires: date_now + ten_minutes,
          path: "/",
          domain: cookie_domain,
          secure: false
        });
        $.cookie("search_history_date_" + user_id, date_now, {
          expires: date_now + ten_minutes,
          path: "/",
          domain: cookie_domain,
          secure: false
        });

        show_search_drop_down();
      },
      error: function() {
        show_search_drop_down();
      }
    });
  }
}

function get_term_local_data(key) {
  var data = {};
  if (localStorage) {
    data = localStorage.getItem(key);
    if (data) {
      try {
        data = JSON.parse(data);
      } catch (e) {
        data = {};
      }
    }
  } else {
    data = window['local_' + key];
  }

  return (data) ? data : {};
}

function get_cookie_term_local_data(key) {
  var data = $.cookie(key);
  try {
    data = JSON.parse(data);
  } catch (e) {
    data = {};
  }
  return data;
}

function remove_search_history() {
  $.ajax({
    url: "/misc/remove_search_history",
    success: function() {
      var cookie_domain = '';
      if (typeof KASKUS_COOKIE_DOMAIN !== 'undefined')
        cookie_domain = KASKUS_COOKIE_DOMAIN;
      else
        cookie_domain = COOKIE_DOMAIN;
      date_now = Date.now() / 1000;
      $.cookie("search_history_" + user_id, '[]', {
        expires: date_now + ten_minutes,
        path: "/",
        domain: cookie_domain,
        secure: false
      });
      $.cookie("search_history_date_" + user_id, date_now, {
        expires: date_now + ten_minutes,
        path: "/",
        domain: cookie_domain,
        secure: false
      });

      show_search_drop_down();
    }
  });
}

function fetchCategories() {
  url = KASKUS_URL + '/misc/get_categories/' + catVersion;
  $.retrieveJSON(url, {}, function(a) {
    if (retryFetch && a.version != catVersion) {
      $.clearJSON(url, {});
      retryFetch = false;
      fetchCategories();
    } else {
      $('#cat-forum').replaceWith(a.forum);
      $('#cat-jb').replaceWith(a.jb);
      catLoaded = true;

      var liSelected,
        valscroll;
      $("#filter-cat-forum").bind("keydown keyup", function(event) {
        var li = $("#update-tag ul.sidebar-category").find('li');
        // if keydown
        if (event.which === 40) {
          if (event.type === 'keydown') {
            if (liSelected) {
              liSelected.removeClass('selected');
              next = liSelected.next();
              if (next.length > 0) {
                liSelected = next.addClass('selected');
              } else {
                liSelected.addClass('selected');
              }
            } else {
              liSelected = li.eq(0).addClass('selected');
            }
          }
          valscroll = ($(".scrolling-con-update ul li.selected").position().top) - 140;
          // $('.mCSB_container').attr('style', 'position:relative;top:-'+ valscroll +'px;');
          // if keyup
        } else if (event.which === 38) {
          if (event.type === 'keydown') {
            if (liSelected) {
              liSelected.removeClass('selected');
              next = liSelected.prev();
              if (next.length > 0) {
                liSelected = next.addClass('selected');
              } else {
                liSelected.addClass('selected');
              }
            } else {
              liSelected = li.last().addClass('selected');
            }
          }
          //valscroll = ( $(".scrolling-con-update ul li.selected").position().top ) - 140;
          //$('.mCSB_container').attr('style', 'position:relative;top:-'+ valscroll +'px;');
          // presss enter get redirect URL
        } else if (event.which === 13) {
          if ($('.scrolling-con-update').find('li.selected').length > 0) {
            window.location = $('.scrolling-con-update li.selected .categories-title').children('a').attr('href');
          }
        } else {
          // keyup get data json and append listing data
          if (event.type === 'keyup') {
            $("#update-tag ul.sidebar-category").find('li').removeClass('selected');
            searchField = $('#filter-cat-forum').val();
            $(".flyout__search i").removeClass("fa-search");
            $(".flyout__search i").addClass("fa-times");
            // close filter categories
            $('#jsCategoryTabForum .flyout__search i.fa-times').click(function(event) {
              $(this).removeClass("fa-times");
              $(this).addClass("fa-search");

              $('#filter-cat-forum').val('');
              $('#update-tag').html('');
              $('#update-tag').addClass('hide');
            });
            try {
              myExp = new RegExp(searchField, 'i');
              if (searchField === '') {
                $('#update-tag').addClass('hide');
                $("#jsCategoryTabForum .flyout__search i").removeClass("fa-times");
                $("#jsCategoryTabForum .flyout__search i").removeClass("fa-search");


                return false;
              }
              $.retrieveJSON(urlCatJSON, {
                usergroupid: userGroupIdJSON
              }, function(data) {
                $('#update-tag').removeClass('hide');
                //heightUpdateContent = $('.tag-wrap').height() - 28;
                //$('#update-tag').children('.scrolling-con-update').height(heightUpdateContent);
                output = '<ul class="flyout__result__list"><div class="flyout__scroll flyout__scroll--up"><i class="fa fa-chevron-up"></i></div>';
                $.each(data, function(key, val) {
                  if (val.forum_name.search(myExp) != -1) {
                    output += '<li class="flyout__result__item">';
                    output += '<a class="flyout__result__link" href="' + decodeURIComponent(val.forum_url) + '">';
                    output += '<img src="' + decodeURIComponent(val.forum_icon) + '" alt="" width="20" height="20" ><span>' + decodeURIComponent(val.forum_name);
                    output += '</span></a>';
                    output += '</li>';
                  }
                });
                output += '<div class="flyout__scroll flyout__scroll--down"><i class="fa fa-chevron-down"></i></div></ul>';
                $('#update-tag').html(output);

              }, 864e5);
              liSelected = '';
              checkScroller(".flyout__result__list");
            } catch (err) {
              // console.log(err);
            }
          }
        }
      });

      $("#filter-cat-jb").bind("keydown keyup", function(event) {
        var li = $("#update-tag ul.sidebar-category").find('li');
        // if keydown
        if (event.which === 40) {
          if (event.type === 'keydown') {
            if (liSelected) {
              liSelected.removeClass('selected');
              next = liSelected.next();
              if (next.length > 0) {
                liSelected = next.addClass('selected');
              } else {
                liSelected.addClass('selected');
              }
            } else {
              liSelected = li.eq(0).addClass('selected');
            }
          }
          valscroll = ($(".scrolling-con-update ul li.selected").position().top) - 140;
          // $('.mCSB_container').attr('style', 'position:relative;top:-'+ valscroll +'px;');
          // if keyup
        } else if (event.which === 38) {
          if (event.type === 'keydown') {
            if (liSelected) {
              liSelected.removeClass('selected');
              next = liSelected.prev();
              if (next.length > 0) {
                liSelected = next.addClass('selected');
              } else {
                liSelected.addClass('selected');
              }
            } else {
              liSelected = li.last().addClass('selected');
            }
          }
          //valscroll = ( $(".scrolling-con-update ul li.selected").position().top ) - 140;
          //$('.mCSB_container').attr('style', 'position:relative;top:-'+ valscroll +'px;');
          // presss enter get redirect URL
        } else if (event.which === 13) {
          if ($('.scrolling-con-update').find('li.selected').length > 0) {
            window.location = $('.scrolling-con-update li.selected .categories-title').children('a').attr('href');
          }
        } else {
          // keyup get data json and append listing data
          if (event.type === 'keyup') {
            $("#update-tag ul.sidebar-category").find('li').removeClass('selected');
            searchField = $('#filter-cat-jb').val();
            $(".flyout__search i").removeClass("fa-search");
            $(".flyout__search i").addClass("fa-times");
            // close filter categories
            $('#jsCategoryTabJB .flyout__search i.fa-times').click(function() {

              $(this).removeClass("fa-times ");
              $(this).addClass("fa-search ");
              $('#filter-cat-jb').val('');
              $('#update-tag').html('');
              $('#update-tag').addClass('hide');
            });
            try {
              myExp = new RegExp(searchField, 'i');
              if (searchField === '') {
                $('#update-tag').addClass('hide');
                $("#jsCategoryTabJB .flyout__search i").removeClass("fa-times");
                $("#jsCategoryTabJB .flyout__search i").addClass("fa-search");
                return false;
              }
              $.retrieveJSON(urlCatJSON, {
                usergroupid: userGroupIdJSON
              }, function(data) {
                $('#update-tag').removeClass('hide');
                //heightUpdateContent = $('.tag-wrap').height() - 28;
                //$('#update-tag').children('.scrolling-con-update').height(heightUpdateContent);
                output = '<ul class="flyout__result__list"><div class="flyout__scroll flyout__scroll--up"><i class="fa fa-chevron-up"></i></div>';
                $.each(data, function(key, val) {
                  if (val.forum_name.search(myExp) != -1) {
                    output += '<li class="flyout__result__item">';
                    output += '<a class="flyout__result__link" href="' + decodeURIComponent(val.forum_url) + '">';
                    output += '<img src="' + decodeURIComponent(val.forum_icon) + '" alt="" width="20" height="20" ><span>' + decodeURIComponent(val.forum_name);
                    output += '</span></a>';
                    output += '</li>';
                  }
                });
                output += '<div class="flyout__scroll flyout__scroll--down"><i class="fa fa-chevron-down"></i></div></ul>';
                $('#update-tag').html(output);

              }, 864e5);
              liSelected = '';
              checkScroller(".flyout__result__list");
            } catch (err) {
              // console.log(err);
            }
          }
        }
      });
      if ($('.flyout__tab__pane > .flyout__category__list').length > 0 && $('.flyout__tab__pane > .flyout__category__list')[0].scrollHeight > $('.flyout__tab__pane > .flyout__category__list').height()) {
        $('.flyout__tab__pane > .flyout__category__list').siblings(".flyout__scroll--down").addClass("flyout__scroll--on");
      }
      //scroll top main category nav
      $(".flyout__category__list").bind('scroll', function() {
        checkScroller($(this));
      });

      //scroll top main category search
      $(".flyout__result__list").bind('scroll', function() {
        checkScroller($(this));
      });

      //scroll anakan main category nav
      $(".flyout__category-children__list").bind('scroll', function() {
        checkScroller($(this));
      });
    }
  }, 36e5);
}

function gaTrackOb(el) {
  var category = el.attr("data-category");
  var label = el.attr("data-label");
  var action = el.attr('data-state');

  _gaq.push(['_trackEvent', category, action, label]);
  dataLayer.push({
    'event': 'trackEvent',
    'eventDetails.category': category,
    'eventDetails.action': action,
    'eventDetails.label': label
  });
};

/**
 * Function buat subscribe unsubscribe thread
 */

 var subscribeUnsubscribeOnProgress = false;
 var subscribeUnsubscribeEls = [];

 function subscribeUnsubscribe(el) {
   var index_el_exist = subscribeUnsubscribeEls.indexOf(el.attr('id'));
   if (index_el_exist < 0) {
     subscribeUnsubscribeEls.push(el.attr('id'));
   }
   if (subscribeUnsubscribeOnProgress) {
     return;
   }
   subscribeUnsubscribeOnProgress = true;
   var subscribe_to_do = el.attr('data-state');
   var subscribe_option = el.attr('data-type');
   var subscribe_id = el.attr('data-id');
   var subscribe_url = '/myforum/' + subscribe_to_do + '/' + subscribe_option + '/' + subscribe_id;
   var securitytoken = $('#securitytoken').val();
   var forum_name = el.data('name');

   if (securitytoken) {
     $.ajax({
       type: "POST",
       url: subscribe_url,
       data: {
         securitytoken: securitytoken
       },
       xhrFields: {
         withCredentials: true
       },
       success: function(result) {
         if (typeof result !== 'object') {
           result = $.parseJSON(result);
         }
         if (result.flag == 'TRUE') {
           gaTrackOb(el);
           if (subscribe_to_do == 'subscribe') {
             $('#securitytoken').val(result.securitytoken);
             el.attr("data-state", "unsubscribe");

             if (el.attr('data-style') == 'icon') {
               var iEl = el.find('i:first');
               iEl.addClass("C(#f8c31c)");
               iEl.removeClass("C(#b3b3b3) D(n) listThreadItem:h_D(b) C(#f8c31c):h Cur(p):h is-animate");
             } else if (el.attr('data-style') == 'icon-category') {
               var iEl = el.find('i:first');
               iEl.addClass("C(#f8c31c) C(#b3b3b3):h");
               iEl.removeClass("C(#b3b3b3) D(n) listForumItem:h_D(b) C(#f8c31c):h");
             } else if (el.attr('data-style') == 'icon-thread') {
               el.attr('title', el.attr('title-unsubscribe'));
               var iEl = el.find('i:first');
               iEl.removeClass("C(#b3b3b3)");
               iEl.addClass("C(#f8c31c)");
             } else {
               var spanEl = el.find('span:first');
               spanEl.text('Unsubscribe');
             }
             if (el.data('type') == 'forum') {
               var element_a = el.parent().find('a');
               var parent_old = el.parent();
               var list_subscribed = $('#subscribed_forum').find('.subscribed').length;
               if (list_subscribed == 0) {
                 var parent_div = $('<div/>', {
                   class: 'D(f) Ai(c) Mb(10px)'
                 }).appendTo('#subscribed_forum');
                 var child_div = $('<div/>', {
                   class: 'Pos(r)'
                 }).appendTo(parent_div);
                 var title = $('<span/>', {
                   class: 'Ff(VagRounded) Lts(0.6px) Fz(14px) D(ib) Mt(4px) C(#9e9e9e)',
                   text: 'SUBSCRIPTIONS'
                 }).appendTo(child_div);
                 $('#subscribed_forum').show();
               }
               var parent_div = $('<div/>', {
                 class: 'Py(6px) Pos(r) subscribed Bgc(#f9f9f9):h My(4px)'
               }).appendTo('#subscribed_forum');
               $(element_a).appendTo(parent_div);
               parent_div.attr('data-name', forum_name);
               var subscribed_data = $('#subscribed_forum').find('.subscribed');
               sortCategories(subscribed_data, '#subscribed_forum');
               $(parent_old).remove();
             }
           } else {
             el.attr("data-state", "subscribe");
             if (el.attr('data-style') == 'icon') {
               var iEl = el.find('i:first');
               iEl.removeClass("C(#f8c31c)");
               iEl.addClass("C(#b3b3b3) D(n) listThreadItem:h_D(b) C(#f8c31c):h Cur(p):h is-animate");
             } else if (el.attr('data-style') == 'icon-category') {
               var iEl = el.find('i:first');
               iEl.removeClass("C(#f8c31c)");
               iEl.addClass("C(#b3b3b3) D(n) listForumItem:h_D(b) C(#f8c31c):h Cur(p):h");
             } else if (el.attr('data-style') == 'icon-thread') {
               el.attr('title', el.attr('title-subscribe'));
               var iEl = el.find('i:first');
               iEl.removeClass("C(#f8c31c)");
               iEl.addClass("C(#b3b3b3)");
             } else {
               var spanEl = el.find('span:first');
               spanEl.text('Subscribe');
             }

             if (el.data('type') == 'forum') {
               var id_append = '#child_forum_parent';
               if (el.data('forum-type') == 'regional') {
                 id_append = '#child_regional_parent';
               }
               updateForumCategories(el, id_append, forum_name);
             }
           }
         }
         var index_el = subscribeUnsubscribeEls.indexOf(el.attr('id'));
         if (index_el > -1) {
           subscribeUnsubscribeEls.splice(index_el, 1);
         }
         subscribeUnsubscribeOnProgress = false;
         if (subscribeUnsubscribeEls.length > 0) {
           subscribeUnsubscribe($('#' + subscribeUnsubscribeEls[0]));
         }
       },
       error: function(result) {
         var index_el = subscribeUnsubscribeEls.indexOf(el.attr('id'));
         if (index_el > -1) {
           subscribeUnsubscribeEls.splice(index_el, 1);
         }
         subscribeUnsubscribeOnProgress = false;
         if (subscribeUnsubscribeEls.length > 0) {
           subscribeUnsubscribe($('#' + subscribeUnsubscribeEls[0]));
         }
       }
     });
   } else {
     window.location.href = subscribe_url;
   }
 }

 function updateForumCategories(el, id_append, forum_name)
 {
   var element_a = el.parent().find('a');
   var parent_old = el.parent();
   var parent_div = $('<div/>', {
     class: 'Py(6px) Pos(r) listForumItem subscribed Bgc(#f9f9f9):h My(4px)'
   }).appendTo(id_append);
   $(element_a).appendTo(parent_div);
   $(parent_old).remove();
   parent_div.attr('data-name', forum_name);

   var list_subscribed = $('#subscribed_forum').find('.subscribed').length;

   if (list_subscribed == 0) {
     $('#subscribed_forum > div').remove();
     $('#subscribed_forum').hide();
   }

   // Sorts
   var subscribed_data = $(id_append).find('.subscribed');
   sortCategories(subscribed_data, id_append);
   // Sort
 }

function sortCategories(subscribed_data, id_append)
{
  subscribed_data.sort(function(a,b){
    var an = a.getAttribute('data-name');
    var bn = b.getAttribute('data-name');

    if(an > bn) {
      return 1;
    }
    if(an < bn) {
      return -1;
    }
    return 0;
  });

  subscribed_data.detach().appendTo(id_append);
}

var kaskusMarkItUpSettings = {
  resizeHandle: true,
  markupSet: [{
      name: 'Bold',
      key: 'B',
      openWith: '[B]',
      closeWith: '[/B]'
    },
    {
      name: 'Italic',
      key: 'I',
      openWith: '[I]',
      closeWith: '[/I]'
    },
    {
      name: 'Underline',
      key: 'U',
      openWith: '[U]',
      closeWith: '[/U]'
    }
  ]
}


$(window).bind('scroll', function() {
    //scrollHeader();

    //PositionBackToTop();

    scrollSkyscrapper();
    scrollHeaderSticky();
    //checkStickySubforumSidebar();
});

// function scrollHeader() {
//     var topHeaderPosition;
//
//     if($('.jsNoticeHeader').length > 0){
//
//         if($(window).scrollTop() <  $('.jsNoticeHeader').outerHeight()){
//             topHeaderPosition = $('.jsNoticeHeader').outerHeight() - $(window).scrollTop();
//         }
//         else{
//             topHeaderPosition = 0;
//         }
//         $('.jsNavHeader').css('top', topHeaderPosition + 'px');
//     }
// }

var positionOverlayHeader;

function scrollHeaderSticky() {
    var batasScrollHeader = $('.jsNavHeader').offset().top + $('.jsNavHeader').height();

    if($(window).scrollTop() > (batasScrollHeader)){
      $('.jsStickyHeader').css('transform','translateY(0px)');
      positionOverlayHeader = 0;
      $('.jsFlyoutAnchor').appendTo('.jsFlyoutTriggerSticky');
      $('.jsUserDropdownMenu').appendTo('.jsUserAnchorSticky');
      $('.jsNotificationDropdownMenu').appendTo('.jsNotificationAnchorSticky');
      $('.jsSearchFormInput').blur();

    }
    else{
      $('.jsStickyHeader').css('transform','translateY(-200px)');
      //positionOverlayHeader = $('.jsNavHeader').offset().top + 90 - $(window).scrollTop();
      $('.jsFlyoutAnchor').appendTo('.jsFlyoutTrigger');
      $('.jsUserDropdownMenu').appendTo('.jsUserAnchor');
      $('.jsNotificationDropdownMenu').appendTo('.jsNotificationAnchor');
    }
    //console.log(positionOverlayHeader);
}

function scrollSkyscrapper() {
    var batasAtasWrapperAds = $('.jsLeaderboardSkyscrapper').offset().top;
    var tinggiNavHeader = $('.jsStickyHeader').height();
    var tinggiSkyscrapper = 600;
    var tinggiMainContent  = $('.jsMainContent').outerHeight();
    var tinggiLeaderboard = 250 - $('.jsLeaderboardAds').outerHeight();
    var spacingBawah = 30;
    var spacingAtas = 10;
    var posisiFixed = tinggiNavHeader + spacingAtas;
    var posisiAbsolute = tinggiMainContent - (tinggiSkyscrapper/2) - spacingBawah - tinggiLeaderboard;
    var batasAtasFooter = $('.jsMainFooter').offset().top;
    var batasHarusFixed = batasAtasWrapperAds - tinggiNavHeader - spacingAtas;
    var batasHarusAbsolute = batasAtasFooter - tinggiSkyscrapper - posisiFixed - spacingBawah;

    //kondisi harus sticky
    if($(window).scrollTop() > batasHarusFixed){
      //console.log(tinggiMainContent );
      $('.jsSkyscrapperAds').css('position','fixed');
      $('.jsSkyscrapperAds').css('transform','translateY('+ posisiFixed +'px)');
      //kondisi harus absolute
      if($(window).scrollTop() > batasHarusAbsolute){
        $('.jsSkyscrapperAds').css('position','absolute');
        $('.jsSkyscrapperAds').css('transform','translateY('+ posisiAbsolute + 'px)');
      }
    }
    //kondisi awal
    else{
      $('.jsSkyscrapperAds').css('position','initial');
      $('.jsSkyscrapperAds').css('transform','none');
    }
}

/*
function buat subforum fixed sidebar
 */
function checkStickySubforumSidebar(){
    var scrollToFixed;
    var anchorMainContent = $('.jsMainContent').offset().top;
    var heightMainContent = $('.jsMainContent').outerHeight();
    var heightSidebar = $('.jsSubforumFixedSidebar').outerHeight();
    if($(window).scrollTop() > (anchorMainContent - 50)){
      //$('.jsSubforumFixedSidebar').css("transform", 'translateY(60px)');
      $('.jsSubforumFixedSidebar').css("top", '50px');
      if($(window).scrollTop() > (anchorMainContent + heightMainContent - heightSidebar - 50)){
        scrollToFixed = (anchorMainContent + heightMainContent) - $(window).scrollTop() - (heightSidebar);
        $('.jsSubforumFixedSidebar').css('top', scrollToFixed+'px');
      }
    }
    else{
      scrollToFixed = ($('.jsMainContent').offset().top - $(window).scrollTop());
      $('.jsSubforumFixedSidebar').css('top', scrollToFixed+'px');
    }
}

function checkScroller(element) {
    if (element[0].scrollHeight > element.height()) {
		// mentok bawah
		if (element[0].scrollHeight - element.scrollTop() == element.outerHeight())
        {
            element.siblings(".flyout__scroll--down").removeClass( "flyout__scroll--on" );
        }
        // mentok atas
        else if(element.scrollTop() === 0)
        {
            element.siblings(".flyout__scroll--up").removeClass( "flyout__scroll--on" );
        }
		else{
			element.siblings(".flyout__scroll--down").addClass( "flyout__scroll--on" );
			element.siblings(".flyout__scroll--up").addClass( "flyout__scroll--on" );
		}

	}
}

//scroll top main category nav
$(".flyout__category__list").bind('scroll', function() {
	checkScroller($(this));
});

$(".flyout__subscribed__list").bind('scroll', function() {
	checkScroller($(this));
});

//scroll top main category search
$(".flyout__result__list").bind('scroll', function() {
	checkScroller($(this));
});

//scroll anakan main category nav
$(".flyout__category-children__list").bind('scroll', function() {
	checkScroller($(this));
});


$( ".jsFollowingButton" ).hover(function() {

});

$( ".jsFollowingButton" ).hover(
  function() {
    $( this ).text('Unfollow');
  }, function() {
    $( this ).text('Following');
  }
);

$( ".jsUserMenu" )
	.mouseover(function() {
    $(this).find('.jsUserDropdownMenu').toggleClass("is-visible");
    toggleOverlay();
  	})
 	.mouseout(function() {
    	$(this).find('.jsUserDropdownMenu').toggleClass("is-visible");
      toggleOverlay();
  	});

$( ".jsNotificationMenu" )
	.mouseover(function() {
    $(this).find('.jsNotificationDropdownMenu').toggleClass("is-visible");
    toggleOverlay();
  	})
 	.mouseout(function() {
    	$(this).find('.jsNotificationDropdownMenu').toggleClass("is-visible");
      toggleOverlay();
  	});


// $( ".flyout__trigger" )
// 	.mouseover(function() {
//     	$(".flyout__anchor").show();
//       toggleOverlay();
//
//     	if($('.flyout__tab__pane > .flyout__category__list').length > 0 && $('.flyout__tab__pane > .flyout__category__list')[0].scrollHeight > $('.flyout__tab__pane > .flyout__category__list').height()){
// 	  		$('.flyout__tab__pane > .flyout__category__list').siblings(".flyout__scroll--down").addClass( "flyout__scroll--on" );
// 	  	}
// 	  	if($('.flyout__subscribed__list').length > 0 && $('.flyout__subscribed__list')[0].scrollHeight > $('.flyout__subscribed__list').height()){
// 	  		$('flyout__subscribed__list').siblings(".flyout__scroll--down").addClass( "flyout__scroll--on" );
// 	  	}
//   	})
//  	.mouseout(function() {
//       console.log("wwwwwww");
//     	$(".flyout__anchor").hide();
//       toggleOverlay();
//   	});

    $( ".flyout__trigger" )
      .on( "mouseenter", function() {
        $(".flyout__anchor").show();
        toggleOverlay();

      	if($('.flyout__tab__pane > .flyout__category__list').length > 0 && $('.flyout__tab__pane > .flyout__category__list')[0].scrollHeight > $('.flyout__tab__pane > .flyout__category__list').height()){
  	  		$('.flyout__tab__pane > .flyout__category__list').siblings(".flyout__scroll--down").addClass( "flyout__scroll--on" );
  	  	}
  	  	if($('.flyout__subscribed__list').length > 0 && $('.flyout__subscribed__list')[0].scrollHeight > $('.flyout__subscribed__list').height()){
  	  		$('flyout__subscribed__list').siblings(".flyout__scroll--down").addClass( "flyout__scroll--on" );
  	  	}
      })
      .on( "mouseleave", function() {
        $(".flyout__anchor").hide();
        toggleOverlay();
      });

$( ".flyout__content" )
	.mouseenter(function() {
    	$(this).closest(".flyout__anchor").show();
  	})
	.mouseleave(function() {
    	$(this).closest(".flyout__anchor").hide();
  	});

$( ".flyout__category__item--has-children , .flyout__category-children__item--has-children"  )
	.mouseover(function() {
    	$(this).closest(".flyout__content").addClass( "flyout__content--triggered" );
    	if($(this).find('.flyout__category-children__list').first().length > 0 && $(this).find('.flyout__category-children__list').first()[0].scrollHeight > $(this).find('.flyout__category-children__list').first().height()){
	  		$(this).find('.flyout__category-children__list').first().siblings(".flyout__scroll--down").addClass( "flyout__scroll--on" );
	  	}
  	})
  	.mouseout(function() {
    	$(this).closest(".flyout__content").removeClass( "flyout__content--triggered" );
  	});

$( ".flyout__subscribed__anchor" )
	.mouseover(function() {
    	$(this).closest(".flyout__content").addClass( "flyout__content--triggered" );
    	$(this).closest(".flyout__anchor").addClass( "flyout__anchor--subscribed" );
    	if($(this).find('.flyout__subscribed__list').length > 0 && $(this).find('.flyout__subscribed__list')[0].scrollHeight > $(this).find('.flyout__subscribed__list').height()){
	  		$(this).find('.flyout__subscribed__list').siblings(".flyout__scroll--down").addClass( "flyout__scroll--on" );
	  	}
  	})
  	.mouseout(function() {
    	$(this).closest(".flyout__content").removeClass( "flyout__content--triggered" );
    	$(this).closest(".flyout__anchor").removeClass( "flyout__anchor--subscribed" );
  	});

$( ".flyout__subscribed__panel" )
	.mouseover(function() {
    	$(this).siblings(".flyout__subscribed__anchor__link").addClass( "flyout__subscribed__anchor__link--hovered" );
  	})
  	.mouseout(function() {
    	$(this).siblings(".flyout__subscribed__anchor__link").removeClass( "flyout__subscribed__anchor__link--hovered" );
  	});

$( ".flyout__category__panel" )
	.mouseover(function() {
    	$(this).siblings(".flyout__category__link").addClass( "flyout__category__link--hovered" );
    	$(this).siblings(".flyout__category-children__link").addClass( "flyout__category-children__link--hovered" );
  	})
  	.mouseout(function() {
    	$(this).siblings(".flyout__category__link").removeClass( "flyout__category__link--hovered" );
    	$(this).siblings(".flyout__category-children__link").removeClass( "flyout__category-children__link--hovered" );
  	});


var scrolling = false;
function scrollContent(direction,element) {
    var amount = (direction === "up" ? "-=5px" : "+=5px");
    $(element).animate({
        scrollTop: amount
    }, 1, function() {
        if (scrolling) {
            scrollContent(direction,element);
        }
    });
}

$(".flyout__scroll--down")
	.bind("mouseover", function(event) {
    	scrolling = true;
    	scrollContent("down",$(this).siblings(".flyout__category-children__list"));
    	scrollContent("down",$(this).siblings(".flyout__category__list"));
    	scrollContent("down",$(this).siblings(".flyout__result__list"));
    	scrollContent("down",$(this).siblings(".flyout__subscribed__list"));
	})
	.bind("mouseout", function(event) {
    	scrolling = false;
	});

$(".flyout__scroll--up")
	.bind("mouseover", function(event) {
    	scrolling = true;
    	scrollContent("up",$(this).siblings(".flyout__category-children__list"));
    	scrollContent("up",$(this).siblings(".flyout__category__list"));
    	scrollContent("up",$(this).siblings(".flyout__result__list"));
    	scrollContent("up",$(this).siblings(".flyout__subscribed__list"));
	})
	.bind("mouseout", function(event) {
    	scrolling = false;
	});


var booleanOverlay = true;

function toggleOverlay(){
  if(booleanOverlay){
    //$('body').addClass("Ov(h)");
    $('.jsNavHeaderOverlay').show();
    $('.jsNavHeaderOverlay').css('top', positionOverlayHeader+'px');
    booleanOverlay = false;
  }
  else{
    //$('body').removeClass("Ov(h)");
    $('.jsNavHeaderOverlay').hide();
    booleanOverlay = true;
  }
}

function showBottomToast(text, time) {
    $('.jsBottomToast').addClass('is-visible');
    $('.jsBottomToast').text(text);
    setTimeout(function(){
      $('.jsBottomToast').removeClass('is-visible');
    }, time);
}

function bindPopoverMenu(){
  $('body').on('click','.jsPopoverTrigger',function(){
    var others = $('.jsPopoverTrigger').not(this);
    others.next().removeClass('is-visible');
    if($(this).next().hasClass("is-visible")){
      $(this).next().removeClass("is-visible");
    }
    else{
      $(this).next().addClass("is-visible");
    }
  });
}

/*
   Function to insert BBCode, it receives 3 parameter. The openWith and closeWith parameters are used to wrap the text with the BBCode tag. The textbox parameter defines which textbox element should be used.
 */
function insertBBCode(openWith, closeWith, textbox){
    var objectTextbox = document.querySelector(textbox);
    var jqueryTextbox = $(textbox);
    var posSelectionStart = objectTextbox.selectionStart;
    var posSelectionEnd = objectTextbox.selectionEnd;
    var textAreaTxt = jqueryTextbox.val();
    var selection = textAreaTxt.substring(posSelectionStart, posSelectionEnd);
    var txtToAddStart = openWith;
    var txtToAddEnd = closeWith;
    jqueryTextbox.val(textAreaTxt.substring(0, posSelectionStart) + txtToAddStart + selection + txtToAddEnd + textAreaTxt.substring( posSelectionEnd ));
    objectTextbox.focus();
    objectTextbox.selectionStart = posSelectionStart + txtToAddStart.length + selection.length + txtToAddEnd.length;
    objectTextbox.selectionEnd = posSelectionStart + txtToAddStart.length + selection.length + txtToAddEnd.length;
}


$(document).ready(function() {

  $('.jsNgetopTabButton').click(function(){
    var indexElement = $(".jsNgetopTabButton").index(this);
    $('.jsNgetopTabButton').removeClass("is-active");
    $(this).addClass("is-active");
    $('.jsNgetopTabLine').css('transform','translateX('+$(this).position().left+'px)');
    $('.jsNgetopTabContent').css('transform','translateX(-'+(indexElement*100)+'%)');
    $('.jsNgetopTabContent').css('height', $(".jsNgetopTabContent > div:nth-child("+(indexElement+1)+")").height());
  });


  tippy('.jsTippy', {
    theme: 'translucent',
    arrow: true,
    size: 'small'
  });

  var clipboard = new ClipboardJS('.jsClipboardButton');

  clipboard.on('success', function(e) {
      showBottomToast("URL Copied to Clipboard", '2000');
  });

  $('.jsButtonSmilies').click(function(){
    if(!$('.jsSmiliesContainer').hasClass('is-visible')){
        $('.jsSmiliesContainer').addClass('is-visible');
        $(this).css('color', '#1998ed');
    }
    else{
      $('.jsSmiliesContainer').removeClass('is-visible');
      $(this).removeAttr( 'style' );
    }
  });

  $('.jsSubscribeThreadIcon').click(function(){
    subscribeUnsubscribe($(this));
  });

  $('#jsReplyTextArea').focus( function() {
    $('.jsReplyTools').show();
    $('.jsReplyUser').removeClass('Pos(a)');
    $('.jsReplyUser span').show();
    $(this).removeClass('Px(40px)');

  });

  autosize($('#jsReplyTextArea'));

  $('#jsReplyTextArea').blur( function() {

  });

  /*
    Click event toggling
   */
  $('.jsCompactTrigger').click(function(){
    if(!$('body').hasClass('is-compact')){
      $('body').addClass('is-compact');
      $(this).find('i').addClass('fa-list-ul').removeClass('fa-th-large');
    }
    else{
      $('body').removeClass('is-compact');
      $(this).find('i').addClass('fa-th-large').removeClass('fa-list-ul');
    }
  });

  bindPopoverMenu();

  scrollHeaderSticky();

  $(".is-remove-all").mousedown(function(e) {
	 	e.preventDefault();
	});

  $('.jsModalTrigger').click(function(){
    $('.jsModal').removeClass('is-open');
    var modalTarget = $(this).attr('data-modal');
    var modalElement =  $('#'+modalTarget);
    modalElement.addClass('is-open');
    modalElement.find('.jsModalDialog').addClass('is-animate');
    $('body').addClass('Ov(h)');
  });

  $(".mls-img").kslzy(300);

  $('.jsButtonMultiquote').click(function(){
    $(this).toggleClass('is-animate is-selected');
  })

  if($('.flyout__trigger').length > 0)
	{
		$('.flyout__trigger').hover(function(){
			if(!catLoaded)
			{
				fetchCategories();
			}
		});
	}
	if (linksearch !== '')
	{
		get_cat(searchchoice);
	}

  $('body').on('click','.jsFormPasswordToggle',function(){
    var formPasswordInput = $(this).closest('.jsFormPassword').find('.jsFormPasswordInput');
    var formPasswordIcon = $(this).closest('.jsFormPassword').find('i');
    if(formPasswordInput.attr('type') == 'text'){
      var isPassword = false;
    }
    else{
      var isPassword = true;
    }

    if(isPassword){
        formPasswordIcon.removeClass('fa-eye-slash');
        formPasswordIcon.addClass('fa-eye');
        formPasswordInput.attr('type', 'text');
    }
    else{
        formPasswordIcon.removeClass('fa-eye');
        formPasswordIcon.addClass('fa-eye-slash');
        formPasswordInput.attr('type', 'password');
    }
  });

  $('.jsModal').click(function(event){
    if (!$(event.target).closest('.jsModalContent').length) {
      $('.jsModal').removeClass('is-open');
      $('body').removeClass('Ov(h)');
    }
  });

  $('.jsFirstPostItemTrigger').click(function(){
    if(!$('.jsFirstPostItemContent').hasClass('is-hide')){
        $('.jsFirstPostItemContent').addClass('is-hide');
        $('.jsFirstPostItemContent').slideUp();
        $(this).find('i').removeClass('fa-angle-up').addClass('fa-angle-down');
        $(this).find('span').text('Lihat Isi Thread');
        $('html, body').animate({
            scrollTop: $(".jsFirstPostItemContent").offset().top - 300
         }, 400);
    }
    else{
      $('.jsFirstPostItemContent').removeClass('is-hide');
      $('.jsFirstPostItemContent').slideDown();
      $(this).find('i').removeClass('fa-angle-down').addClass('fa-angle-up');
      $(this).find('span').text('Sembunyikan Isi Thread');
    }
  });

  $('.jsSpoilerTrigger').click(function(event){
    $(this).closest('.jsSpoiler').toggleClass('is-open');
    $(this).find('i').toggleClass('fa-angle-down fa-angle-up');
    if ($(this).closest('.jsSpoiler').hasClass('is-open')) {
      $(this).find('span').text('Hide');
      $(this).closest('.jsSpoiler').find('.jsSpoilerContent').first().slideDown();
    }
    else{
      $(this).find('span').text('Show');
      $(this).closest('.jsSpoiler').find('.jsSpoilerContent').first().slideUp();
    }
  });

  $('.jsTabLink').click(function(){
		var tabId = $(this).attr('data-tab');

		$('.jsTabLink, .jsTabContent').removeClass('is-active');

		$(this).addClass('is-active');
		$("#"+tabId).addClass('is-active');
	});

  $('.jsSearchFormInput').focus( function() {
    $('.jsSearchResult').addClass('is-open');
    $('.jsNavHeaderOverlay').show();
    //$('.jsNavHeaderOverlay').css('top', ($('.jsNavHeader').offset().top + 90 - $(window).scrollTop())+'px');
  });

  $('.jsSearchFormInput').blur( function() {
    $('.jsSearchResult').removeClass('is-open');
    $('.jsNavHeaderOverlay').hide();
  });

  $('.jsModalCloseButton').click(function(){
    $('.jsModal').removeClass('is-open');
    $('body').removeClass('Ov(h)');
  });

  $("#search").keydown(function(event) {
 		$(".jsSearchResult").find('li').removeClass('Bgc(#f2f2f2)');
 		var totalIndex = $(".jsSearchResult .jsSearchWrapper li").length-1;

	  	if ( event.which == 38 ) {
	   		if(indexSelected>0){
	   			indexSelected--;
	   		}
	   		else{
	   			indexSelected = totalIndex;
	   		}
	   		setSelectedSearch();
	   		return false;
	  	}
	  	else if( event.which == 40 ) {
	  		if(indexSelected<totalIndex){
	   			indexSelected++;
	   		}
	   		else{
	   			indexSelected = 0;
	   		}
	   		setSelectedSearch();
	  	}
	});

	function setSelectedSearch () {
		var selectedElement = ".jsSearchResult .jsSearchWrapper li:eq(" + indexSelected + ")";
    var selectedElementValue = $(selectedElement).find('a').text();

    $("#search").val(selectedElementValue);
	  $(selectedElement).addClass('Bgc(#f2f2f2)');
		$("#search").attr("value",selectedElementValue);
		$("#search").blur();
		$("#search").focus();
	}

  // $('.jsUserAvatar').click(function(){
  //   $(this).next().toggleClass("is-visible");
  //   toggleOverlay();
  // });

  // $('.jsNotificationIcon').click(function(){
  //   $(this).next().toggleClass("is-visible");
  //   toggleOverlay();
  // });

  $(document).on('click', function(event) {

    if (!$(event.target).closest('.jsPopover, .jsUserMenu, .jsNotificationMenu, .jsFlyoutMenu, .jsSearchContainer, .jsReplyTools, #jsReplyTextArea ').length) {
      $('.jsPopoverMenu').removeClass('is-visible');
      $('.jsSmiliesContainer').removeClass('is-visible');
      $('.jsButtonSmilies').removeAttr( 'style' );
      if($('#jsReplyTextArea').length && $('#jsReplyTextArea').val().length == 0){
          $('.jsReplyTools').hide();
          $('.jsReplyUser').addClass('Pos(a)');
          $('.jsReplyUser span').hide();
          $('#jsReplyTextArea').addClass('Px(40px)');
      }
      // $( '.jsUserDropdownMenu' ).removeClass('is-visible');
      // $( '.jsNotificationDropdownMenu' ).removeClass('is-visible');
      // $( 'body').removeClass('Ov(h)');
      // $( '.jsNavHeaderOverlay').hide();


    }
  });

  // $('.jsSidebarLeft').stickySidebar({
  //     innerWrapperSelector: '.jsSidebarLeftInner',
  //     topSpacing: 100,
  //     bottomSpacing: 60
  // });
  //
  // $('.jsSidebarRight').stickySidebar({
  //     innerWrapperSelector: '.jsSidebarRightInner',
  //     topSpacing: 100,
  //     bottomSpacing: 60
  // });

  // $(".jsStickyColumn").stick_in_parent({
  //   parent: ".jsStickyParent",
  //   spacer: ".jsStickySpacer",
  //   offset_top: 60
  // });

  // $('.').stickybits();
  // stickybits('.jsStickyColumn', {verticalPosition: 'bottom'});
  stickybits('.jsStickyAnchor', {stickyBitStickyOffset: 60 });

  //scrollHeader();

  // Accordion
  var menuAccordion = $('.jsMenuAccordion');
  menuAccordion.children('ul').find('a').click(function() {
  	var checkElement = $(this).next();
  	if ((checkElement.is('ul')) && (checkElement.is(':visible'))) {
  		$(this).closest('li').removeClass('is-open');
      $(this).find('.jsMenuAccordionIcon').toggleClass('fa-angle-down fa-angle-up');
  		checkElement.slideUp();
  	}
  	if ((checkElement.is('ul')) && (!checkElement.is(':visible'))) {
  		menuAccordion.children('ul').find('ul:visible').slideUp();
  		menuAccordion.find('li').removeClass('is-open');
      menuAccordion.find('.jsMenuAccordionIcon').removeClass('fa-angle-up').addClass('fa-angle-down');
  		$(this).closest('li').addClass('is-open');
      $(this).find('.jsMenuAccordionIcon').toggleClass('fa-angle-down fa-angle-up');
  		checkElement.slideDown();
  	}

  	if ($(this).closest('li').find('ul').children().length === 0) {
  		return true;
  	}else{
  		return false;
  	}
  });

});
