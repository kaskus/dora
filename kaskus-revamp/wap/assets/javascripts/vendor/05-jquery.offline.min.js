/*!
 * jQuery Cache modified from jQuery Offline Version 1.0.0
 *
 * http://github.com/wycats/jquery-offline
 *
 * Copyright 2010, Yehuda Katz
 */
!function(v){function p(r,a,o){v.isFunction(a)&&(o=a,a=null);var n=r+"?"+v.param(a||{});return!l[n]&&(l[n]=!0,v.ajax({type:"GET",url:r,data:a,success:function(e,t){delete l[n],void 0!==e?o(e,t):window.navigator.onLine||(w=function(){p(r,a,o)})},error:function(){delete l[n]},dataType:"json",ifModified:!0}))}var m="kaskus.cache.jquery:",w=null,l={};if(void 0===v.support.localStorage){var e=function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}};v.support.localStorage=!!window.localStorage&&e()}v.support.localStorage?(v(window).bind("online",function(){w&&w()}),v(window).bind("offline",function(){v.event.trigger("ajaxStop")}),v.retrieveJSON=function(e,t,a,r){function o(){for(var e=[],t=0;t<localStorage.length;++t){var r=localStorage.key(t);/:date$/.test(r)&&e.push(r)}e.sort(function(e,t){var r=localStorage[e],a=localStorage[t];return r<a?-1:a<r?1:0});for(var t=0;t<e.length/2;++t){var r=e[t];delete localStorage[r],delete localStorage[r.substr(0,r.length-5)]}}function n(){return p(e,t,function(e,t){if("notmodified"==t)return!1;for(;;)try{localStorage[i]=JSON.stringify(e),localStorage[i+":date"]=new Date;break}catch(e){"QUOTA_EXCEEDED_ERR"!=e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!=e.name&&"QuotaExceededError"!=e.name||o();break}var r;a(e,t,u&&{cachedAt:f,retrievedAt:l})})}v.isFunction(t)&&(a=t,t={});var l=new Date,c=v.param(t),i=m+e+":"+c,u=localStorage[i],d=localStorage[i+":date"],f=new Date(Date.parse(d)),r=void 0!==r?r:0;if(!u)return n();var g=v.parseJSON(u),S;if(!1!==a(g,"cached",{cachedAt:f}))return w=n,!(0<r&&l.getTime()-f.getTime()>r)||n();var s=v.Deferred().promise();return s.done=function(e){e(g)},s},v.clearJSON=function(e,t){var r=v.param(t||{});delete localStorage[m+e+":"+r],delete localStorage[m+e+":"+r+":date"]}):(v.retrieveJSON=p,v.clearJSON=v.noop)}(jQuery);