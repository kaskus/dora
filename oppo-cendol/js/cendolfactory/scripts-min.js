!function(){function e(){var e,c,f,d,l;for(c=document.querySelectorAll("img.sprite"),d=c.length;d--;){for(e={},e.effects=[],e.img=c[d],e.offset=c[d].offsetWidth/2,f=c[d].getAttribute("data-collision").split(","),l=f.length;l--;){var u=f[l].split(":");e.effects.push({effect:u[0],value:parseInt(u[1])})}e.type=c[d].getAttribute("data-type"),e.frames=c[d].getAttribute("data-frames"),P.push(e)}z=P.length,ee=+$("#characters").getAttribute("data-countstart"),te=+$("#characters").getAttribute("data-newsprite"),w.tabIndex=-1,w.focus(),w.addEventListener("keydown",i,!1),w.addEventListener("keyup",n,!1),w.addEventListener("touchstart",a,!1),w.addEventListener("touchend",o,!1),w.addEventListener("click",t,!1),w.addEventListener("mousemove",s,!1),window.addEventListener("deviceorientation",r,!1),localStorage.html5catcher?Z=JSON.parse(localStorage.html5catcher):(Z={last:0,high:0},localStorage.html5catcher=JSON.stringify(Z)),h(),"ondeviceorientation"in window&&($("#androidbrowser").style.display="none")}function t(e){var t=e.target;"gameover"===D&&"replay"===t.id&&(me.play(),h()),"next"===t.className&&instructionsnext(),"endinstructions"===t.className&&instructionsdone(),"instructionbutton"===t.id&&showinstructions(),"playbutton"===t.id&&(c(),me.play()),e.preventDefault()}function i(e){39===e.keyCode?ie=!0:37===e.keyCode&&(ne=!0)}function n(e){39===e.keyCode?ie=!1:37===e.keyCode&&(ne=!1)}function a(e){"playing"===D&&e.preventDefault(),e.target===M?ie=!0:e.target===L&&(ne=!0)}function o(e){"playing"===D&&e.preventDefault(),e.target===M?ie=!1:e.target===L&&(ne=!1)}function r(e){e.gamma<0&&(J+=e.gamma/3.2),e.gamma>0&&(J+=e.gamma/3.2),K>J&&(J=K),J>Q-K&&(J=Q-K)}function s(e){var t=e.clientX-w.offsetLeft;K>t&&(t=K),t>Q-K&&(t=Q-K),J=t}function h(){v(b),D="intro";var e=b.querySelectorAll("output");e[0].innerHTML=Z.last,e[1].innerHTML=Z.high}function c(){for(v(A),D="playing",document.body.className="playing",Q=A.offsetWidth,U=A.offsetHeight,C.width=Q,C.height=U,X=U-x.offsetHeight,K=x.offsetWidth/2,J=Q/2,O=[],Y=0;ee>Y;Y++)O.push(g(!0));R.energy=F,R.score=0,V=0,_=0,S.innerHTML=F,q.innerHTML=R.score,f(),de.play(),ae.load(),oe.load(),se.load(),he.load(),fe.load(),le.load(),ue.load()}function f(){for(E.clearRect(0,0,Q,U),j=O.length,Y=0;Y<j;Y++)O[Y].render(),O[Y].update();S.innerHTML=R.energy,q.innerHTML=R.score;var e=R.energy,t=H.childNodes.length,i=e-t,n=document.createElement("LI");if(i>0)for(;i--;)H.appendChild(n);else for(i=Math.abs(i);i--;)H.removeChild(H.childNodes[0]);R.score/te>V&&(O.push(g(!1)),V++),ie&&l(),ne&&d(),E.save(),E.translate(J-K,X),E.drawImage(x,0,0),E.restore(),R.energy=Math.min(R.energy,3),R.energy>0?requestAnimationFrame(f):u()}function d(){J-=W,K>J&&(J=K)}function l(){J+=W,J>Q-K&&(J=Q-K)}function u(){document.body.className="gameover",v(N),D="gameover";var e=R.score;N.querySelector("output").innerHTML=e,Z.last=e,e>Z.high&&(T.innerHTML=T.getAttribute("data-highscore"),Z.high=e),localStorage.html5catcher=JSON.stringify(Z),de.pause(),de.currentTime=0,le.play(),ue.play(),_gaq.push(["_trackEvent","cendolfactory","levelincrease","level_"+V])}function m(){this.px=0,this.py=0,this.vx=0,this.vy=0,this.goodguy=!1,this.height=0,this.width=0,this.lebarAsli=0,this.effects=[],this.img=null,this.frameIndex=0,this.tickCount=0,this.ticksPerFrame=3,this.frames=null,this.update=function(){if(this.px+=this.vx,this.py+=this.vy,~~(this.py+10)>X&&J-K<this.px&&this.px<J+K)if(this.py=-200,Y=this.effects.length,"good"===this.type)for(;Y--;)R[this.effects[Y].effect]+=this.effects[Y].value,re[Math.floor(Math.random()*re.length)].play();else if("donat"===this.type)for(;Y--;)"energy"===this.effects[Y].effect&&(R[this.effects[Y].effect]+=this.effects[Y].value,fe.play());else for(;Y--;)"energy"===this.effects[Y].effect&&(R[this.effects[Y].effect]+=this.effects[Y].value,ce[Math.floor(Math.random()*ce.length)].play());if(this.tickCount+=1,this.tickCount>this.ticksPerFrame&&(this.tickCount=0,this.frameIndex<this.frames-1?this.frameIndex+=1:this.frameIndex=0),(this.px>Q-this.offset||this.px<this.offset)&&(this.vx=-this.vx),this.py>U+100){if("good"===this.type)for(Y=this.effects.length;Y--;){R.energy--;break}y(this,!1)}},this.render=function(){E.save(),E.translate(this.px,this.py),E.translate(this.width/this.frames*-.5,this.height*-.5),E.drawImage(this.img,this.frameIndex*this.width/this.frames,0,this.width/this.frames,this.height,0,0,this.width/this.frames,this.height),E.restore()}}function g(e){var t=new m;return y(t,e),t}function y(e,t){if(t)var i=z-1;else var i=~~p(0,z);return"donat"===P[i].type&&Math.min(R.energy,3)===maxnyawa?y(e):(e.img=P[i].img,e.frames=P[i].frames,e.height=e.img.offsetHeight,e.width=e.img.offsetWidth,e.type=P[i].type,e.effects=P[i].effects,e.offset=P[i].offset,e.py=-100,e.lebarAsli=e.width/e.frames,e.px=p(0+e.lebarAsli,Q-e.lebarAsli),e.vx=p(-1,2),void(e.vy=p(1,5)))}function $(e){return document.querySelector(e)}function p(e,t){return Math.random()*(t-e)+e}function v(e){G&&(G.className=""),e.className="current",G=e}var w=$("#container"),A=$("#playfield"),x=$("#player"),b=$("#intro"),k=$("#instructions"),L=$(".left"),M=$(".right"),q=$("#score output"),S=$("#energy output"),H=$("#energy ul"),C=$("canvas"),N=$("#gameover"),T=N.querySelector(".message"),I=document.querySelectorAll("li.introdeck"),E=C.getContext("2d"),F=+S.innerHTML;maxnyawa=3;var R={energy:F,score:0},W=+x.getAttribute("data-increase"),_=0,D=null,J=0,O=[],P=[],z=0,B=0,G=null,X=0,K=0,Q=0,U=0,V=0,Y=0,Z=null,ee=0,te=500,ie=!1,ne=!1,ae=new Audio("/audio/cendolfactory/cendol-cendolx2.mp3"),oe=new Audio("/audio/cendolfactory/cendol-slurp.mp3"),re=[ae,oe],se=new Audio("/audio/cendolfactory/bata-aduh.mp3"),he=new Audio("/audio/cendolfactory/bata-ouch.mp3"),ce=[se,he],fe=new Audio("/audio/cendolfactory/donat-wihdonat.mp3"),de=new Audio("/audio/cendolfactory/BGM.mp3");de.loop=!0,de.volume=.75;var le=new Audio("/audio/cendolfactory/gameover-huutidak.mp3"),ue=new Audio("/audio/cendolfactory/game_over.mp3");ue.volume=.75;var me=new Audio("/audio/cendolfactory/beep.wav");window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)}}()),e()}();