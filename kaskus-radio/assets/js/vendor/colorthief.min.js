var CanvasImage=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};CanvasImage.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},CanvasImage.prototype.update=function(t){this.context.putImageData(t,0,0)},CanvasImage.prototype.getPixelCount=function(){return this.width*this.height},CanvasImage.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},CanvasImage.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var ColorThief=function(){};if(ColorThief.prototype.getColor=function(t,r){return this.getPalette(t,5,r)[0]},ColorThief.prototype.getPalette=function(t,r,n){void 0===r&&(r=10),(void 0===n||n<1)&&(n=10);for(var o=new CanvasImage(t),e=o.getImageData(),a=e.data,i=o.getPixelCount(),u=[],c=0,f,s,v,h,p;c<i;c+=n)f=4*c,s=a[f+0],v=a[f+1],h=a[f+2],(p=a[f+3])>=125&&(s>250&&v>250&&h>250||u.push([s,v,h]));var g=MMCQ.quantize(u,r),l=g?g.palette():null;return o.removeCanvas(),l},!pv)var pv={map:function(t,r){var n={};return r?t.map(function(t,o){return n.index=o,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,o,e){return n.index=e,t+r.call(n,o)}:function(t,r){return t+r},0)},max:function(t,r){return Math.max.apply(null,r?pv.map(t,r):t)}};var MMCQ=function(){function t(t,r,n){return(t<<2*c)+(r<<c)+n}function r(t){function r(){n.sort(t),o=!0}var n=[],o=!1;return{push:function(t){n.push(t),o=!1},peek:function(t){return o||r(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return o||r(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return o||r(),n}}}function n(t,r,n,o,e,a,i){var u=this;u.r1=t,u.r2=r,u.g1=n,u.g2=o,u.b1=e,u.b2=a,u.histo=i}function o(){this.vboxes=new r(function(t,r){return pv.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function e(r){var n=1<<3*c,o=new Array(n),e,a,i,u;return r.forEach(function(r){a=r[0]>>f,i=r[1]>>f,u=r[2]>>f,e=t(a,i,u),o[e]=(o[e]||0)+1}),o}function a(t,r){var o=1e6,e=0,a=1e6,i=0,u=1e6,c=0,s,v,h;return t.forEach(function(t){s=t[0]>>f,v=t[1]>>f,h=t[2]>>f,s<o?o=s:s>e&&(e=s),v<a?a=v:v>i&&(i=v),h<u?u=h:h>c&&(c=h)}),new n(o,e,a,i,u,c,r)}function i(r,n){function o(t){var r=t+"1",o=t+"2",e,a,i,u,h,p=0;for(v=n[r];v<=n[o];v++)if(f[v]>c/2){for(i=n.copy(),u=n.copy(),e=v-n[r],a=n[o]-v,h=e<=a?Math.min(n[o]-1,~~(v+a/2)):Math.max(n[r],~~(v-1-e/2));!f[h];)h++;for(p=s[h];!p&&f[h-1];)p=s[--h];return i[o]=h,u[r]=i[o]+1,[i,u]}}if(n.count()){var e=n.r2-n.r1+1,a=n.g2-n.g1+1,i=n.b2-n.b1+1,u=pv.max([e,a,i]);if(1==n.count())return[n.copy()];var c=0,f=[],s=[],v,h,p,g,l;if(u==e)for(v=n.r1;v<=n.r2;v++){for(g=0,h=n.g1;h<=n.g2;h++)for(p=n.b1;p<=n.b2;p++)l=t(v,h,p),g+=r[l]||0;c+=g,f[v]=c}else if(u==a)for(v=n.g1;v<=n.g2;v++){for(g=0,h=n.r1;h<=n.r2;h++)for(p=n.b1;p<=n.b2;p++)l=t(h,v,p),g+=r[l]||0;c+=g,f[v]=c}else for(v=n.b1;v<=n.b2;v++){for(g=0,h=n.r1;h<=n.r2;h++)for(p=n.g1;p<=n.g2;p++)l=t(h,p,v),g+=r[l]||0;c+=g,f[v]=c}return f.forEach(function(t,r){s[r]=c-t}),o(u==e?"r":u==a?"g":"b")}}function u(t,n){function u(t,r){for(var n=1,o=0,e;o<s;)if(e=t.pop(),e.count()){var a=i(f,e),u=a[0],c=a[1];if(!u)return;if(t.push(u),c&&(t.push(c),n++),n>=r)return;if(o++>s)return}else t.push(e),o++}if(!t.length||n<2||n>256)return!1;var f=e(t),h=1<<3*c,p=0;f.forEach(function(){p++});var g=a(t,f),l=new r(function(t,r){return pv.naturalOrder(t.count(),r.count())});l.push(g),u(l,v*n);for(var b=new r(function(t,r){return pv.naturalOrder(t.count()*t.volume(),r.count()*r.volume())});l.size();)b.push(l.pop());u(b,n-b.size());for(var m=new o;b.size();)m.push(b.pop());return m}var c=5,f=8-c,s=1e3,v=.75;return n.prototype={volume:function(t){var r=this;return r._volume&&!t||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(r){var n=this,o=n.histo;if(!n._count_set||r){var e=0,a,i,u;for(a=n.r1;a<=n.r2;a++)for(i=n.g1;i<=n.g2;i++)for(u=n.b1;u<=n.b2;u++)index=t(a,i,u),e+=o[index]||0;n._count=e,n._count_set=!0}return n._count},copy:function(){var t=this;return new n(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(r){var n=this,o=n.histo;if(!n._avg||r){var e=0,a=1<<8-c,i=0,u=0,f=0,s,v,h,p,g;for(v=n.r1;v<=n.r2;v++)for(h=n.g1;h<=n.g2;h++)for(p=n.b1;p<=n.b2;p++)g=t(v,h,p),s=o[g]||0,e+=s,i+=s*(v+.5)*a,u+=s*(h+.5)*a,f+=s*(p+.5)*a;n._avg=e?[~~(i/e),~~(u/e),~~(f/e)]:[~~(a*(n.r1+n.r2+1)/2),~~(a*(n.g1+n.g2+1)/2),~~(a*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(t){var r=this,n=t[0]>>f;return gval=t[1]>>f,bval=t[2]>>f,n>=r.r1&&n<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},o.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r=this.vboxes,n,o,e,a=0;a<r.size();a++)((o=Math.sqrt(Math.pow(t[0]-r.peek(a).color[0],2)+Math.pow(t[1]-r.peek(a).color[1],2)+Math.pow(t[2]-r.peek(a).color[2],2)))<n||void 0===n)&&(n=o,e=r.peek(a).color);return e},forcebw:function(){var t=this.vboxes;t.sort(function(t,r){return pv.naturalOrder(pv.sum(t.color),pv.sum(r.color))});var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[n].color=[255,255,255])}},{quantize:u}}();